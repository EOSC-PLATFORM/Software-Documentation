# Processing dumps

## ToC

- [Introduction](#introduction)
- [Incremental processing](#incremental-processing)
- [Relations between resources](#relations-between-resources)


## Introduction

The preprocessor is processing multiple data dumps, some of which originate from OARG, other from EOSC Marketplace.


## What is OARG?

OARG stands for OpenAIRE Research Graph. The graph includes metadata and links between scientific products (e.g. 
literature, datasets, software, and "other research products"), organizations, funders, funding streams, projects, 
communities, and (provenance) data sources. See https://graph.openaire.eu to learn more.


## Search Service dumps vs. OARG dumps

The original OARG dumps are initially processed by [EOSC Search Service] and then imported by the preprocessor to an 
HDFS filesystem via an AWS S3-compliant interface. For that reason, the preprocessor is not processing original OARG 
data.

[EOSC Search Service]: https://github.com/cyfronet-fid/eosc-search-service/tree/master/transform.


## Incremental processing

To be designed collaboratively with the AI team ...


## Relations between resources

Relations are expected to be read from JSONL dumps produced by the Search Service. The relations are stored in two 
fields: 
- `relations`, an array of IDs of other resources in relation with that particular resource. Reflects a field 
  `target` from the [original openaire schema](relations-openaireschema.json).
- `relations_long`, the above extended with *relation name* and *relation type*.  

This is not what was initially planned - a single json attribute having a schema compliant with [relations-openaireschema.json](relations-openaireschema.json).

Example of the `relations`:

    "relations": [
      "50|doi_dedup___::19e0904ab3f3f6f5469a7825dcbf672c",
      "50|doi_dedup___::19e0904ab3f3f6f5469a7825dcbf672c",
      "50|doi_dedup___::19e0904ab3f3f6f5469a7825dcbf672c",
      "50|doi_dedup___::0445c8d78f837b8cf51cd631e38d53cf",
      "50|doi_dedup___::0445c8d78f837b8cf51cd631e38d53cf"
    ]


Example of the `relations_long`:

    "relations_long": [
      "[50|doi_dedup___::19e0904ab3f3f6f5469a7825dcbf672c, HasAmongTopNSimilarDocuments, similarity]",
      "[50|doi_dedup___::19e0904ab3f3f6f5469a7825dcbf672c, IsAmongTopNSimilarDocuments, similarity]",
      "[50|doi_dedup___::19e0904ab3f3f6f5469a7825dcbf672c, IsDerivedFrom, relationship]",
      "[50|doi_dedup___::0445c8d78f837b8cf51cd631e38d53cf, IsAmongTopNSimilarDocuments, similarity]",
      "[50|doi_dedup___::0445c8d78f837b8cf51cd631e38d53cf, HasAmongTopNSimilarDocuments, similarity]"
    ]


Pattern for the `relations_long`:

    relations_long: ["[target_id, relation_name, relation_type]", "[target_id2, relation_name2, relation_type2]", ....] (edited)


See also:
- For research purpose real examples of relations can be downloaded from
[Zenodo](https://sandbox.zenodo.org/record/1151397/files/relation.tar?download=1)
- The [official documentation](https://graph.openaire.eu/docs/data-model/relationships) about relations.
- The original comment from the developer of Search Service (Michał Kołomański):
  > Dane się wrzucają pod dzisiejszą datą na S3.
  > Jak wiecie doszło do schemy Openerowej dodatkowe pole relations.
  > Przepraszam ale musiałem jednak zmienić lekko schemę tego pola relations w naszej schemie. Na śmierć zapomniałem, 
  > że do Solra generalnie bardzo utrodnione jest dodawanie takich nested JSONów (pole relations wlasnie takim zagnieżdzonym JSONem jest) i to pole zrobiłem płaskie (tak jak cała reszta dumpa). Niestety ale solr to nie jest baza danych tylko silnik do przeszukiwania.
  > Wskutek czego:
  > - pojawiły się u nas w danych dwa nowe pola:
  >   - relations: array(strings) -> lista IDików resourców z którymi ten dany resource ma jakies relacje. Pole target ze schemy Openaire,
  >   - relations_long: array(strings) -> lista IDików resourców z którymi ten dany resource ma jakies relacje + nazwa relacji + typ relacji. Pole target ze schemy Openaire + pole name oraz type z reltype ze schemy Openaire.
  >   - usunałem pole source w ogole gdyz to jest po prostu ten sam ID co ma resource w polu ID. Nie ma sensu tego powtarzać
  >   - usunałem tez pole provenance gdyz nie za bardzo widziałem w nim value dla kogokolwiek.
  >   - bezposredni linik do dumpa openaire https://sandbox.zenodo.org/record/1167594 (jeszcze nie przerobionego)


## Available attributes of JSONL dump

Below you can find documented pseudo-schemas for dump files that are generated by Search Service. The preprocessor 
is expecting dumps to be compliant with those schemas.

To learn how to generate such schemas from a particular dumps file, please refer to 
[README.md - "operations" section](../../README.md). 

Avaliable attributes of JSONL dump are splitted according to type of resource.
See references for list of:
- Trainings
    - [available attributes](../resource-dump-analysis/training_avaliable_attributes.md)
    - [not null attributes](../resource-dump-analysis/training_not_null_attributes.md)
    - [null attributes](../resource-dump-analysis/training_null_attributes.md)
- Datasources
    - [available attributes](../resource-dump-analysis/datasource_avaliable_attributes.md)
    - [not null attributes](../resource-dump-analysis/datasource_not_null_attributes.md)
    - [null attributes](../resource-dump-analysis/datasource_null_attributes.md)
- Services
    - [available attributes](../resource-dump-analysis/service_avaliable_attributes.md)
    - [not null attributes](../resource-dump-analysis/service_not_null_attributes.md)
    - [null attributes](../resource-dump-analysis/service_null_attributes.md)
- Publications
    - [available attributes](../resource-dump-analysis/publication_avaliable_attributes.md)
    - [not null attributes](../resource-dump-analysis/publication_not_null_attributes.md)
    - [null attributes](../resource-dump-analysis/publication_null_attributes.md)
- Other research products
    - [available attributes](../resource-dump-analysis/other_rp_avaliable_attributes.md)
    - [not null attributes](../resource-dump-analysis/other_rp_not_null_attributes.md)
    - [null attributes](../resource-dump-analysis/other_rp_null_attributes.md)
- Software
    - [available attributes](../resource-dump-analysis/software_avaliable_attributes.md)
    - [not null attributes](../resource-dump-analysis/software_not_null_attributes.md)
    - [null attributes](../resource-dump-analysis/software_null_attributes.md)
- Datasets
    - [available attributes](../resource-dump-analysis/dataset_avaliable_attributes.md)
    - [not null attributes](../resource-dump-analysis/dataset_not_null_attributes.md)
    - [null attributes](../resource-dump-analysis/dataset_null_attributes.md)

Counters in `not null attributes` inform how many times an attribute was present.

Counters in `null attributes` inform how many times an attribute was empty or null.
