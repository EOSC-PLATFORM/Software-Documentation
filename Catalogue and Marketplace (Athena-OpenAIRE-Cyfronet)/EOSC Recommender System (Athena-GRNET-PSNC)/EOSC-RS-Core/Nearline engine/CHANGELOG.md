# Changelog
All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.5.3] - 2023-12-01
### Added
- Training events processing

## [1.5.1] - 2023-11-28
### Added
- Model, that's generates embeddings for users
### Changed
- Now UA do not disappear in process of storing new user

## [1.5.0] - 2023-11-16
### Added
- Add checking if schema of data tables in postgres is correct
- Added Handover documentation to the project
- Added scalability functionality (now you can run multiple instances of
  processing and storing threads)
### Changed
- Change Connector into DynamicSwitch, ProcessSwitch, StoringSwitch
- A lot of cosmetic changes in code

## [1.4.6] - 2023-09-15
### Changed
- All constant values are now set to final values
### Removed
- All unused code
- All unused endpoints

## [1.4.5] - 2023-09-13
### Added
- Garbage collector for pyspark processing
- Basic unittests for pyspark processing
### Fixed
- Logging during one of exceptions

## [1.4.4] - 2023-08-29
### Added
- Deletion of resources from user profile that not exists in resource database
- Connection from spark to hbase
### Changed
- Changed `otherresearchproduct` to `other_research_product` and `data_source` to `data_sources`
### Fixed
- Buf when Postgres connection is closed and someone use /diag endpoint
- Refactor `Job` class into 5 different classes
- Now resourceId cannot contain space
### Removed
- Old processing of resources
- remove `user_entity` from project tree

## [1.4.3] - 2023-08-02
### Fixed
- Bug that occur when someone order service

## [1.4.2] - 2023-08-01
### Added
- Differential resource processing on Spark (with new endpoint)
- Optional parameters (as environmental variables) for spark-submit command
### Changed
- polling method for kafka consumer
### Fixed
- Bug, when nearline is starting and there is no connection to HBASE
(hbase connector is created later)
### Removed

## [1.4.1] - 2023-07-19
### Added
- Add column `isvalid` for resource tables, which tells if given resource is valid
- Metadata tables stores number of isvalid resources
- Environment variables with paths in HDFS for spark (starting with `SPARK_`)
### Changed
- All services are always valid
- Saving embedding generated by Spark to Postgres and updating metadata tables
- Now only last time of multiple visits is saved
### Fixed
- Now to stark spark job resource type must be provided and be one of the
correct types
- Bug that occur when new services was added to database
### Removed
- Kafka debug endpoints

## [1.4.0] - 2023-05-31
### Added
- Endpoint to creating embeddings for resource on Spark cluster (saving only to HDFS)
### Changed
- Variable counter in /diag endpoint now shows all UA processed (no only artificial)
- List of user likes and dislikes now are unique.
### Fixed
- Bug involving infinity loop during try refreshing connection with Postgres
- Security problem involving random library.
- Logging of exceptions

## [1.3.4] - 2023-04-27
### Added
- Handling likes and dislikes (saving to database action when user
clicks on like or dislike button)
- Handling service events (information about change in service description)
### Changed
- Extended Kafka topics for debugging; if they are not set in env they are not used.
### Fixed
- Catching more exception and printing them with `logger.error`
### Removed

## [1.3.3] - 2023-03-09
### Added
- Handling "data sources"
- HBaseConnector (with same interface as PostgresConnector)
### Changed
- HBase port is now read from environment variable `HBASE_PORT`
- Preprocessor endpoint is now read from environment variable
`PREPROCESSOR_DIAG_ENDPOINT`
- Now Processor use 2 database connectors: for users tables and for resources tables
- Processor(HBaseConnector) now handling work that HBase class was doing
- There is no longer division for databases users tables
(variables `HBASE_(...)_USERS` was deleted) and now all databases uses
`(...)_USERS_TABLE`
### Fixed
- Fix a diagnostic endpoint
- Check if given resourceType exists
- Speed up process of saving new users (need less operation on database)
### Removed
- HBase class

## [1.3.2] - 2023-01-24
### Added
- Handling User Events
- Test case for PostgresConnector and PostgresProcessor
- Documentation
### Changed
- stop using temporary connection to jms
### Fixed
### Removed
- move up old files to another branch

## [1.3.1] - 2022-12-14
### Added
- temporary connection to jms
- scripts, which initialize databases
### Changed
- postgres tables are now definable in .env
### Fixed
### Removed
- few older files

## [1.3.0] - 2022-11-18
### Added
- connector with postgresql
- pre-commit hooks
- dynamic saving new users into postgres
- handling "other research products"
### Changed
- change title of the api doc
- now embeddings of resources are imported from postgres
### Fixed
- now group_id and auto.offset.reset of kafka consumer are set from config
### Removed
- MySql connector retired

## [1.2.1] = 2022-10-20
### Added
- health checks for KafkaRunner and MySqlConnector
### Changed
- join all diagnostics endpoints into /diag
### Fixed
- add missing "trainings" to map
### Removed
- /test endpoint
- unused notebooks

## [1.2.0] = 2022-10-11
### Added
- Support of AAI_uid
- testcases for Kafka and MySql and HBase, and mocks for them
- /stop and /restart endpoints for kafka
- Endpoint to check if Preprocessor is running
### Changed
- Format of reading embeddings from database ( from each embedding in
separate column to all embeddings in one and binary encoded )

## [1.1.0] = 2022-07-20
### Added
- Generating embeddings for users at the base of their ordered resources
- Generating embeddings for users at the base of their visited resources
- Starting kafka consumer loop (which read user actions) when starting applications
- Reading embeddings of resources from MySql
- Updating embeddings of users in Hbase
- Diagnostic endpoints: checking if applications is running, checking if MySql
  connections works, checking if there is connections with HBase,
  checking if there is connection with Kafka
### Changed
- Main purpose of module: from generating embeddings for resources to generating
  embeddings for users(generating embeddings is still there, it is going to be
  in use later)
- Generating embeddings are now on branch **slurm**

## [1.0.0] = 2022-04-29
### Added
- Generating embeddings for resources
- Connector with MySql
- Connector with HBase
- Saving embeddings of resources in MySql
- Saving embeddings of resources in HBase
- Saving embeddings of resources in HDFS
- Reading information about resources from HDFS
- Endpoint for starting processing given file in HDFS
- Using deep learning model for generating embeddings from description of resource
- Mlflow for logging metrics(time of processing, number of processed resources)
